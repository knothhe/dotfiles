chezmoi-cd() {
    local chezmoi_dir="${CHEZMOI_WORKING_TREE:-$HOME/.local/share/chezmoi}"
    cd "$chezmoi_dir"
}

# Claude Code launcher with model provider switching
cc() {
    local provider=""
    local claude_args=()
    local export_only=false

    if [[ $# -eq 0 ]]; then
        echo "Usage: cc <provider> [claude_code_args...]"
        echo "       cc --export|-e <provider>   # Export env vars to current shell"
        echo ""
        echo "Providers:"
        echo "  anthropic    Use Anthropic Claude models (aliases: anth)"
        echo "  bigmodel     Use BigModel (glm-4.5) models (aliases: glm, big)"
        echo "  moonshot     Use Moonshot AI models (aliases: moon, kimi)"
        echo ""
        echo "Examples:"
        echo "  cc anthropic --model sonnet-4-5"
        echo "  cc bigmodel --help"
        echo "  cc moonshot my_project/"
        echo "  cc -e bigmodel                 # Export bigmodel env vars to shell"
        echo "  eval \"\$(cc -e anthropic)\"     # Use eval to export to current shell"
        return 1
    fi

    if [[ "$1" == "--export" || "$1" == "-e" ]]; then
        export_only=true
        shift
    fi

    if [[ $# -eq 0 ]]; then
        echo "Error: Provider required" >&2
        return 1
    fi

    provider="$1"
    shift

    # Unset all relevant environment variables to avoid conflicts
    unset ANTHROPIC_MODEL_PROVIDER
    unset ANTHROPIC_BASE_URL
    unset ANTHROPIC_AUTH_TOKEN
    unset ANTHROPIC_MODEL
    unset ANTHROPIC_SMALL_FAST_MODEL
    unset ANTHROPIC_DEFAULT_SONNET_MODEL
    unset ANTHROPIC_DEFAULT_OPUS_MODEL
    unset ANTHROPIC_DEFAULT_HAIKU_MODEL

    case "$provider" in
        "anthropic"|"anth")
            # Anthropic Claude configuration
            export ANTHROPIC_MODEL_PROVIDER="anthropic"
            # unset any custom BASE_URL to use Anthropic's default
            unset ANTHROPIC_BASE_URL
            claude_args=("$@")
            ;;
        "bigmodel"|"glm"|"big")
            # BigModel (glm-x) configuration
            export ANTHROPIC_MODEL_PROVIDER="bigmodel"
            export ANTHROPIC_BASE_URL=https://open.bigmodel.cn/api/anthropic
            export ANTHROPIC_AUTH_TOKEN={{ pass "token/bigmodel/anthropic_auth_token" }}
            export API_TIMEOUT_MS="3000000"
            export CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC=1
            # Auto-select models (commented out to let Claude Code choose)
            # export ANTHROPIC_MODEL=glm-4.5
            # export ANTHROPIC_SMALL_FAST_MODEL=glm-4.5-air
            claude_args=("$@")
            ;;
        "minimax"|"mm")
            # Minimax (m2.x) configuration
            export ANTHROPIC_MODEL_PROVIDER="minimax"
            export ANTHROPIC_BASE_URL=https://api.minimaxi.com/anthropic
            export ANTHROPIC_AUTH_TOKEN={{ pass "token/minimax/codingplan" }}
            export ANTHROPIC_MODEL="MiniMax-M2.5"
            export ANTHROPIC_SMALL_FAST_MODEL="MiniMax-M2.5"
            export ANTHROPIC_DEFAULT_SONNET_MODEL="MiniMax-M2.5"
            export ANTHROPIC_DEFAULT_OPUS_MODEL="MiniMax-M2.5"
            export ANTHROPIC_DEFAULT_HAIKU_MODEL="MiniMax-M2.5"
            export API_TIMEOUT_MS="3000000"
            export CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC=1
            claude_args=("$@")
            ;;
        "moonshot"|"moon"|"kimi")
            # Moonshot AI configuration
            export ANTHROPIC_MODEL_PROVIDER="moonshot"
            export ANTHROPIC_BASE_URL=https://api.moonshot.cn/anthropic
            export ANTHROPIC_AUTH_TOKEN={{ pass "token/moonshot/anthropic_auth_token" }}
            export ANTHROPIC_MODEL=kimi-k2-turbo-preview
            export ANTHROPIC_SMALL_FAST_MODEL=kimi-k2-turbo-preview
            claude_args=("$@")
            ;;
        *)
            echo "Error: Unknown provider '$provider'"
            echo "Supported providers: anthropic, bigmodel, moonshot"
            return 1
            ;;
    esac

    if [[ "$export_only" == true ]]; then
        # Output export commands for eval
        echo "export ANTHROPIC_MODEL_PROVIDER='${ANTHROPIC_MODEL_PROVIDER}'"
        if [[ -n "${ANTHROPIC_BASE_URL:-}" ]]; then
            echo "export ANTHROPIC_BASE_URL='${ANTHROPIC_BASE_URL}'"
        else
            echo "unset ANTHROPIC_BASE_URL"
        fi
        if [[ -n "${ANTHROPIC_AUTH_TOKEN:-}" ]]; then
            echo "export ANTHROPIC_AUTH_TOKEN='${ANTHROPIC_AUTH_TOKEN}'"
        fi
        if [[ -n "${ANTHROPIC_MODEL:-}" ]]; then
            echo "export ANTHROPIC_MODEL='${ANTHROPIC_MODEL}'"
        fi
        if [[ -n "${ANTHROPIC_SMALL_FAST_MODEL:-}" ]]; then
            echo "export ANTHROPIC_SMALL_FAST_MODEL='${ANTHROPIC_SMALL_FAST_MODEL}'"
        fi
        if [[ -n "${ANTHROPIC_DEFAULT_SONNET_MODEL:-}" ]]; then
            echo "export ANTHROPIC_DEFAULT_SONNET_MODEL='${ANTHROPIC_DEFAULT_SONNET_MODEL}'"
        fi
        if [[ -n "${ANTHROPIC_DEFAULT_OPUS_MODEL:-}" ]]; then
            echo "export ANTHROPIC_DEFAULT_OPUS_MODEL='${ANTHROPIC_DEFAULT_OPUS_MODEL}'"
        fi
        if [[ -n "${ANTHROPIC_DEFAULT_HAIKU_MODEL:-}" ]]; then
            echo "export ANTHROPIC_DEFAULT_HAIKU_MODEL='${ANTHROPIC_DEFAULT_HAIKU_MODEL}'"
        fi
        if [[ -n "${API_TIMEOUT_MS:-}" ]]; then
            echo "export API_TIMEOUT_MS='${API_TIMEOUT_MS}'"
        fi
        if [[ -n "${CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC:-}" ]]; then
            echo "export CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC='${CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC}'"
        fi
        return 0
    fi

    echo "Starting Claude Code with provider: ${provider}"
    if [[ ${#claude_args[@]} -gt 0 ]]; then
        echo "Additional args: ${claude_args[*]}"
    fi

    # Launch Claude Code with the configured environment
    claude "${claude_args[@]}"
}
